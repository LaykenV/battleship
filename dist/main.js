(()=>{"use strict";class e{constructor(e){this.length=e,this.ship=this.CreateShipArray()}CreateShipArray(){let e=[];for(let t=0;t<this.length;t++)e[t]={hit:!1};return e}hit(e){this.ship[e].hit=!0}getShip(){return this.ship}getShipLength(){return this.ship.length}checkHit(e){return!0===e.hit}isSunk(){return!!this.ship.every(this.checkHit)}}class t{constructor(){this.gameBoardArray=this.createGameBoard(),this.missedAttacks=[]}createGameBoard(){let e=[],t=[];for(let a=0;a<10;a++){for(let e=0;e<10;e++)t.push({shipName:void 0,shipIndex:void 0});e.push(t),t=[]}return e}getGameBoard(){return this.gameBoardArray}chechIfShipPlacementIsValid(e,t,a){if(t>10||t<0||a>10||a<0||a+e>10)return!1;for(let r=a;r<a+e;r++)if(null!=this.gameBoardArray[r][t].shipName)return!1;return!0}placeShip(e,t,a){if(this.chechIfShipPlacementIsValid(e.getShipLength(),t,a))for(let r=0;r<e.getShipLength();r++)this.gameBoardArray[a+r][t].shipName=e,this.gameBoardArray[a+r][t].shipIndex=r}receiveAttack(e,t){null==this.gameBoardArray[t][e].shipName?this.missedAttacks.push({x:e,y:t}):this.gameBoardArray[t][e].shipName.hit(this.gameBoardArray[t][e].shipIndex)}getMissedAttacksArray(){return this.missedAttacks}checkIfAllShipSunk(){let e=!0;return this.gameBoardArray.forEach((t=>{t.forEach((t=>{t.shipName&&0==t.shipName.isSunk()&&(e=!1)}))})),e}}class a{constructor(e){this.name=e,this.turn=!0}getName(){return this.name}setName(e){this.name=e}endTurn(e){1==this.turn&&(this.turn=!1,e.startTurn())}startTurn(){0==this.turn&&(this.turn=!0)}checkTurn(){return this.turn}attack(e,t,a,r){this.checkTurn()&&(r.receiveAttack(e,t),this.endTurn(a))}}const r=document.querySelector("#battleship"),i=document.querySelector("#carrier"),n=document.querySelector("#submarine"),s=document.querySelector("#destroyer"),l=document.querySelector("#patrolboat"),c=document.querySelector(".addShips"),h=document.querySelector(".aiSide"),o=document.querySelector("#modal"),d=document.querySelector("#nameInput"),u=document.querySelector("#modalContent"),p=document.querySelector("#playerName"),y=(document.querySelector("#endGameContent"),document.querySelector("#endGameModal")),m=document.querySelector("#playAgainButton"),f=document.querySelector("#winnerText");let S=new e(5),g=new e(4),k=new e(3),A=new e(3),x=new e(2),B=new e(5),I=new e(4),v=new e(3),q=new e(3),N=new e(2),b=new t,w=new t,$=new a("Kuzuha"),L=new class extends a{constructor(e,t,a){super(e,a),this.turn=!1,this.enemyPlayer=t,this.enemyBoard=a,this.attackArray=[]}generateRandomAttack(){if(this.checkTurn()){let e={x:void 0,y:void 0};for(;;){let t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());if(e.x=t,e.y=a,!this.attackArray.some((t=>t.x==e.x&&t.y==e.y))){this.attackArray.push(e),this.attack(e.x,e.y,this.enemyPlayer,this.enemyBoard);break}}}}getAttackArray(){return this.attackArray}}("AI",$,b);function C(e){for(;;){let t=[];if(t=[Math.floor(10*Math.random()),Math.floor(10*Math.random())],w.chechIfShipPlacementIsValid(e.getShipLength(),t[0],t[1])){w.placeShip(e,t[0],t[1]);break}}}function E(e){e.addEventListener("dragstart",(e=>{e.dataTransfer.setData("text/plain",e.target.id)}))}function M(e){let t=e.dataTransfer.getData("text"),a=parseInt(e.target.getAttribute("data-x")),r=parseInt(e.target.getAttribute("data-y"));switch(t){case"battleship":if(b.chechIfShipPlacementIsValid(g.length,a,r)){b.placeShip(g,a,r),G("playerBoard",b);let e=document.querySelector(`#${t}`);c.removeChild(e),c.childNodes.length<=6&&(c.style.display="none",h.style.display="flex")}break;case"carrier":if(b.chechIfShipPlacementIsValid(S.length,a,r)){b.placeShip(S,a,r),G("playerBoard",b);let e=document.querySelector(`#${t}`);c.removeChild(e),c.childNodes.length<=6&&(c.style.display="none",h.style.display="flex")}break;case"submarine":if(b.chechIfShipPlacementIsValid(A.length,a,r)){b.placeShip(A,a,r),G("playerBoard",b);let e=document.querySelector(`#${t}`);c.removeChild(e),c.childNodes.length<=6&&(c.style.display="none",h.style.display="flex")}break;case"destroyer":if(b.chechIfShipPlacementIsValid(k.length,a,r)){b.placeShip(k,a,r),G("playerBoard",b);let e=document.querySelector(`#${t}`);c.removeChild(e),c.childNodes.length<=6&&(c.style.display="none",h.style.display="flex")}break;case"patrolboat":if(b.chechIfShipPlacementIsValid(x.length,a,r)){b.placeShip(x,a,r),G("playerBoard",b);let e=document.querySelector(`#${t}`);c.removeChild(e),c.childNodes.length<=6&&(c.style.display="none",h.style.display="flex")}}}function P(e){let t=document.querySelector(`.${e}`);for(let a=0;a<10;a++)for(let r=0;r<10;r++){let i=document.createElement("div");i.classList.add("cell"),i.setAttribute("data-x",r),i.setAttribute("data-y",a),"aiBoard"==e?i.addEventListener("click",(e=>{T(e.target)})):"playerBoard"==e&&(i.addEventListener("dragover",(e=>{e.preventDefault()})),i.addEventListener("drop",(e=>{e.preventDefault(),M(e)}))),t.appendChild(i)}}function T(e){let t=e.getAttribute("data-x"),a=e.getAttribute("data-y");$.attack(t,a,L,w),G("aiBoard",w),e.style.pointerEvents="none",w.checkIfAllShipSunk()&&V($.getName()),L.generateRandomAttack(),G("playerBoard",b),b.checkIfAllShipSunk()&&V("AI")}function V(e){y.style.display="block",f.textContent=`${e} is the winner!!`}function G(e,t){let a=t.getGameBoard(),r=t.getMissedAttacksArray();a.forEach(((t,a)=>{t.forEach(((t,r)=>{if(t.shipName)if(1==t.shipName.checkHit(t.shipName.getShip()[t.shipIndex])){let t=document.querySelector(`.${e} [data-x="${r}"][data-y ="${a}"]`);t.textContent="X",t.classList.add("hit"),t.classList.remove("occupied")}else 0==t.shipName.checkHit(t.shipName.getShip()[t.shipIndex])&&"playerBoard"==e&&document.querySelector(`.${e} [data-x="${r}"][data-y ="${a}"]`).classList.add("occupied")}))})),r.forEach((t=>{let a=document.querySelector(`.${e} [data-x="${t.x}"][data-y ="${t.y}"]`);a.textContent="X",a.classList.add("missed")}))}E(r),E(i),E(n),E(s),E(l),C(B),C(I),C(v),C(q),C(N),P("playerBoard"),P("aiBoard"),G("playerBoard",b),G("aiBoard",w),u.addEventListener("submit",(e=>{e.preventDefault();let t=d.value||"Player 1";$.setName(t),p.textContent=`${$.getName()}'s Board`,o.style.display="none"})),m.addEventListener("click",(()=>{location.reload()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxHQUNad0MsRUFBWXZDLEdBQ1p1QyxFQUFZdEMsR0FFWm9DLEVBQVlyQixHQUNacUIsRUFBWXBCLEdBQ1pvQixFQUFZbkIsR0FDWm1CLEVBQVlsQixHQUNaa0IsRUFBWWpCLEdBRVptQyxFQUFZLGVBQ1pBLEVBQVksV0FDWkwsRUFBYyxjQUFlN0IsR0FDN0I2QixFQUFjLFVBQVc1QixHQUV6QmhCLEVBQVVrQyxpQkFBaUIsVUFBV0wsSUFDcENBLEVBQUU2QixpQkFDRixJQUFJaEYsRUFBT3FCLEVBQVV1RSxPQUFTLFdBQzlCckQsRUFBT3BDLFFBQVFILEdBQ2Z1QixFQUFXOEQsWUFBYyxHQUFHOUMsRUFBT3JDLG9CQUNuQ2tCLEVBQVVpRCxNQUFNQyxRQUFVLFVBNkk1QjdDLEVBQWdCK0IsaUJBQWlCLFNBQVMsS0FDeENxQyxTQUFTQyxhIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9zaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9haS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgU2hpcCB7XG4gICAgY29uc3RydWN0b3IobGVuZ3RoKSB7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoO1xuICAgICAgICB0aGlzLnNoaXAgPSB0aGlzLkNyZWF0ZVNoaXBBcnJheSgpO1xuICAgIH1cbiAgICBDcmVhdGVTaGlwQXJyYXkoKSB7XG4gICAgICAgIGxldCBzaGlwQXJyYXkgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBzaGlwQXJyYXlbaV0gPSB7IGhpdDogZmFsc2UgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNoaXBBcnJheTtcbiAgICB9XG4gICAgaGl0KGluZGV4KSB7XG4gICAgICAgIHRoaXMuc2hpcFtpbmRleF0uaGl0ID0gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0U2hpcCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hpcDtcbiAgICB9XG4gICAgZ2V0U2hpcExlbmd0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hpcC5sZW5ndGg7XG4gICAgfVxuICAgIGNoZWNrSGl0KGl0ZW0pIHtcbiAgICAgICAgaWYgKGl0ZW0uaGl0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtyZXR1cm4gZmFsc2V9O1xuICAgIH1cbiAgICBpc1N1bmsoKSB7XG4gICAgICAgIGlmICh0aGlzLnNoaXAuZXZlcnkodGhpcy5jaGVja0hpdCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge3JldHVybiBmYWxzZX07XG4gICAgfTtcbn0iLCJleHBvcnQgY2xhc3MgR2FtZUJvYXJkIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgIHRoaXMuZ2FtZUJvYXJkQXJyYXkgPSB0aGlzLmNyZWF0ZUdhbWVCb2FyZCgpO1xuICAgICAgdGhpcy5taXNzZWRBdHRhY2tzID0gW107XG4gICAgfVxuICAgIGNyZWF0ZUdhbWVCb2FyZCgpIHtcbiAgICAgIGxldCBhcnJheSA9IFtdO1xuICAgICAgbGV0IGFycmF5SXRlbSA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICAgIGFycmF5SXRlbS5wdXNoKHsgc2hpcE5hbWU6IHVuZGVmaW5lZCwgc2hpcEluZGV4OiB1bmRlZmluZWQgfSk7XG4gICAgICAgIH1cbiAgICAgICAgYXJyYXkucHVzaChhcnJheUl0ZW0pO1xuICAgICAgICBhcnJheUl0ZW0gPSBbXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhcnJheTtcbiAgICB9XG4gICAgZ2V0R2FtZUJvYXJkKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2FtZUJvYXJkQXJyYXk7XG4gICAgfVxuICAgIGNoZWNoSWZTaGlwUGxhY2VtZW50SXNWYWxpZChsZW5ndGgsIHgsIHkpIHtcbiAgICAgIGlmICh4ID4gMTAgfHwgeCA8IDAgfHwgeSA+IDEwIHx8IHkgPCAwIHx8IHkgKyBsZW5ndGggPiAxMCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmb3IgKGxldCBpID0geTsgaSA8IHkgKyBsZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmICh0aGlzLmdhbWVCb2FyZEFycmF5W2ldW3hdLnNoaXBOYW1lICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH0gXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHBsYWNlU2hpcChzaGlwLCB4LCB5KSB7XG4gICAgICBpZiAodGhpcy5jaGVjaElmU2hpcFBsYWNlbWVudElzVmFsaWQoc2hpcC5nZXRTaGlwTGVuZ3RoKCksIHgsIHkpKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcC5nZXRTaGlwTGVuZ3RoKCk7IGkrKykge1xuICAgICAgICAgIHRoaXMuZ2FtZUJvYXJkQXJyYXlbeSArIGldW3hdLnNoaXBOYW1lID0gc2hpcDtcbiAgICAgICAgICB0aGlzLmdhbWVCb2FyZEFycmF5W3kgKyBpXVt4XS5zaGlwSW5kZXggPSBpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJlY2VpdmVBdHRhY2soeCwgeSkge1xuICAgICAgaWYgKHRoaXMuZ2FtZUJvYXJkQXJyYXlbeV1beF0uc2hpcE5hbWUgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMubWlzc2VkQXR0YWNrcy5wdXNoKHsgeDogeCwgeTogeSB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZ2FtZUJvYXJkQXJyYXlbeV1beF0uc2hpcE5hbWUuaGl0KFxuICAgICAgICAgIHRoaXMuZ2FtZUJvYXJkQXJyYXlbeV1beF0uc2hpcEluZGV4XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIGdldE1pc3NlZEF0dGFja3NBcnJheSgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1pc3NlZEF0dGFja3M7XG4gICAgfVxuICBcbiAgICBjaGVja0lmQWxsU2hpcFN1bmsoKSB7XG4gICAgICBsZXQga2V5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZUJvYXJkQXJyYXkuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBpdGVtLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICBpZiAoZWxlbWVudC5zaGlwTmFtZSkge1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQuc2hpcE5hbWUuaXNTdW5rKCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAga2V5ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGtleTtcbiAgICB9XG4gIH0iLCJleHBvcnQgY2xhc3MgUGxheWVyIHtcbiAgICBjb25zdHJ1Y3RvcihuYW1lKSB7XG4gICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgdGhpcy50dXJuID0gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0TmFtZSgpIHtcbiAgICAgIHJldHVybiB0aGlzLm5hbWU7XG4gICAgfVxuICAgIHNldE5hbWUobmFtZSl7XG4gICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIH1cbiAgICBlbmRUdXJuKHBsYXllcjIpIHtcbiAgICAgIGlmICh0aGlzLnR1cm4gPT0gdHJ1ZSkge1xuICAgICAgICB0aGlzLnR1cm4gPSBmYWxzZTtcbiAgICAgICAgcGxheWVyMi5zdGFydFR1cm4oKTtcbiAgICAgIH1cbiAgICB9XG4gICAgc3RhcnRUdXJuKCkge1xuICAgICAgaWYodGhpcy50dXJuID09IGZhbHNlKXtcbiAgICAgICAgdGhpcy50dXJuID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgY2hlY2tUdXJuKCkge1xuICAgICAgcmV0dXJuIHRoaXMudHVybjtcbiAgICB9XG4gICAgYXR0YWNrKHgsIHksIGVuZW15UGxheWVyLCBlbmVteUJvYXJkKSB7XG4gICAgICBpZiAodGhpcy5jaGVja1R1cm4oKSkge1xuICAgICAgICBlbmVteUJvYXJkLnJlY2VpdmVBdHRhY2soeCwgeSk7XG4gICAgICAgIHRoaXMuZW5kVHVybihlbmVteVBsYXllcik7IFxuICAgICAgfVxuICAgIH1cbiAgfSIsImltcG9ydCB7IFNoaXAgfSBmcm9tIFwiLi9zaGlwLmpzXCI7XG5pbXBvcnQgeyBHYW1lQm9hcmQgfSBmcm9tIFwiLi9nYW1lQm9hcmQuanNcIjtcbmltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuL3BsYXllci5qc1wiO1xuaW1wb3J0IHsgQUkgfSBmcm9tIFwiLi9haS5qc1wiO1xuXG5jb25zdCBiYXR0bGVzaGlwSFRNTCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYmF0dGxlc2hpcFwiKTtcbmNvbnN0IGNhcnJpZXJIVE1MID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJyaWVyXCIpO1xuY29uc3Qgc3VibWFyaW5lSFRNTCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjc3VibWFyaW5lXCIpO1xuY29uc3QgZGVzdHJveWVySFRNTCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVzdHJveWVyXCIpO1xuY29uc3QgcGF0cm9sYm9hdEhUTUwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BhdHJvbGJvYXRcIik7XG5jb25zdCBhZGRTaGlwcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYWRkU2hpcHNcIik7XG5jb25zdCBhaVNpZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmFpU2lkZVwiKTtcbmNvbnN0IG5hbWVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9kYWxcIik7XG5jb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25hbWVJbnB1dFwiKTtcbmNvbnN0IG1vZGFsRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9kYWxDb250ZW50XCIpO1xuY29uc3QgcGxheWVyTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGxheWVyTmFtZVwiKTtcbmNvbnN0IGVuZEdhbWVDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlbmRHYW1lQ29udGVudFwiKTtcbmNvbnN0IGVuZEdhbWVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZW5kR2FtZU1vZGFsXCIpO1xuY29uc3QgcGxheUFnYWluQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwbGF5QWdhaW5CdXR0b25cIik7XG5jb25zdCB3aW5uZXJUZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3aW5uZXJUZXh0XCIpO1xuLy9uZWVkIHRvIGFkZCBlbmQgZ2FtZSBtb2RhbCBhbmQgY2hhcmFjdGVyIGNyZWF0ZSBtb2RhbC5cblxuLy9QbGF5ZXIgU2hpcHNcbmxldCBjYXJyaWVyID0gbmV3IFNoaXAoNSk7XG5sZXQgYmF0dGxlc2hpcCA9IG5ldyBTaGlwKDQpO1xubGV0IGRlc3Ryb3llciA9IG5ldyBTaGlwKDMpO1xubGV0IHN1Ym1hcmluZSA9IG5ldyBTaGlwKDMpO1xubGV0IHBhdHJvbGJvYXQgPSBuZXcgU2hpcCgyKTtcbi8vQUkgU2hpcHNcbmxldCBjYXJyaWVyQUkgPSBuZXcgU2hpcCg1KTtcbmxldCBiYXR0bGVzaGlwQUkgPSBuZXcgU2hpcCg0KTtcbmxldCBkZXN0cm95ZXJBSSA9IG5ldyBTaGlwKDMpO1xubGV0IHN1Ym1hcmluZUFJID0gbmV3IFNoaXAoMyk7XG5sZXQgcGF0cm9sYm9hdEFJID0gbmV3IFNoaXAoMik7XG4vL2dhbWVCb2FyZHNcbmxldCBwbGF5ZXJCb2FyZCA9IG5ldyBHYW1lQm9hcmQoKTtcbmxldCBhaUJvYXJkID0gbmV3IEdhbWVCb2FyZCgpO1xuLy9jcmVhdGUgcGxheWVyc1xubGV0IHBsYXllciA9IG5ldyBQbGF5ZXIoXCJLdXp1aGFcIik7XG5sZXQgYWkgPSBuZXcgQUkoXCJBSVwiLCBwbGF5ZXIsIHBsYXllckJvYXJkKTtcbi8vbWFrZSBwbGF5ZXIgc2hpcHMgZHJhZ2dhYmxlXG5kcmFnU3RhcnRlcihiYXR0bGVzaGlwSFRNTCk7XG5kcmFnU3RhcnRlcihjYXJyaWVySFRNTCk7XG5kcmFnU3RhcnRlcihzdWJtYXJpbmVIVE1MKTtcbmRyYWdTdGFydGVyKGRlc3Ryb3llckhUTUwpO1xuZHJhZ1N0YXJ0ZXIocGF0cm9sYm9hdEhUTUwpO1xuLy9yYW5kb21seSBwbGFjZSBhaSBzaGlwc1xucGxhY2VBSVNoaXAoY2FycmllckFJKTtcbnBsYWNlQUlTaGlwKGJhdHRsZXNoaXBBSSk7XG5wbGFjZUFJU2hpcChkZXN0cm95ZXJBSSk7XG5wbGFjZUFJU2hpcChzdWJtYXJpbmVBSSk7XG5wbGFjZUFJU2hpcChwYXRyb2xib2F0QUkpO1xuLy9jcmVhdGUgaHRtbCBib2FyZHNcbmNyZWF0ZUJvYXJkKFwicGxheWVyQm9hcmRcIik7XG5jcmVhdGVCb2FyZChcImFpQm9hcmRcIik7XG51cGRhdGVEaXNwbGF5KFwicGxheWVyQm9hcmRcIiwgcGxheWVyQm9hcmQpO1xudXBkYXRlRGlzcGxheShcImFpQm9hcmRcIiwgYWlCb2FyZCk7XG4vL3NldCBwbGF5ZXIgbmFtZVxubW9kYWxGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICBsZXQgbmFtZSA9IG5hbWVJbnB1dC52YWx1ZSB8fCBcIlBsYXllciAxXCI7XG4gIHBsYXllci5zZXROYW1lKG5hbWUpO1xuICBwbGF5ZXJOYW1lLnRleHRDb250ZW50ID0gYCR7cGxheWVyLmdldE5hbWUoKX0ncyBCb2FyZGA7XG4gIG5hbWVNb2RhbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG59KTtcblxuZnVuY3Rpb24gcGxhY2VBSVNoaXAoc2hpcCkge1xuICB3aGlsZSAodHJ1ZSkge1xuICAgIGxldCBudW1iZXJBcnJheSA9IFtdO1xuICAgIGxldCBmaXJzdE51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICBsZXQgc2Vjb25kTnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgIG51bWJlckFycmF5ID0gW2ZpcnN0TnVtYmVyLCBzZWNvbmROdW1iZXJdO1xuICAgIGlmIChcbiAgICAgIGFpQm9hcmQuY2hlY2hJZlNoaXBQbGFjZW1lbnRJc1ZhbGlkKFxuICAgICAgICBzaGlwLmdldFNoaXBMZW5ndGgoKSxcbiAgICAgICAgbnVtYmVyQXJyYXlbMF0sXG4gICAgICAgIG51bWJlckFycmF5WzFdXG4gICAgICApXG4gICAgKSB7XG4gICAgICBhaUJvYXJkLnBsYWNlU2hpcChzaGlwLCBudW1iZXJBcnJheVswXSwgbnVtYmVyQXJyYXlbMV0pO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGRyYWdTdGFydGVyKGVsZW1lbnQpIHtcbiAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ3N0YXJ0XCIsIChlKSA9PiB7XG4gICAgZS5kYXRhVHJhbnNmZXIuc2V0RGF0YShcInRleHQvcGxhaW5cIiwgZS50YXJnZXQuaWQpO1xuICB9KTtcbn1cbi8vc2hpcCBhZGRpbmcgdGhyb3VnaCBkcm9wXG5mdW5jdGlvbiBkcm9wU2hpcChlKSB7XG4gIGxldCBkYXRhID0gZS5kYXRhVHJhbnNmZXIuZ2V0RGF0YShcInRleHRcIik7XG4gIGxldCB4ID0gcGFyc2VJbnQoZS50YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS14XCIpKTtcbiAgbGV0IHkgPSBwYXJzZUludChlLnRhcmdldC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXlcIikpO1xuICBzd2l0Y2ggKGRhdGEpIHtcbiAgICBjYXNlIFwiYmF0dGxlc2hpcFwiOlxuICAgICAgaWYgKHBsYXllckJvYXJkLmNoZWNoSWZTaGlwUGxhY2VtZW50SXNWYWxpZChiYXR0bGVzaGlwLmxlbmd0aCwgeCwgeSkpIHtcbiAgICAgICAgcGxheWVyQm9hcmQucGxhY2VTaGlwKGJhdHRsZXNoaXAsIHgsIHkpO1xuICAgICAgICB1cGRhdGVEaXNwbGF5KFwicGxheWVyQm9hcmRcIiwgcGxheWVyQm9hcmQpO1xuICAgICAgICBsZXQgc2hpcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2RhdGF9YCk7XG4gICAgICAgIGFkZFNoaXBzLnJlbW92ZUNoaWxkKHNoaXApO1xuICAgICAgICBpZiAoYWRkU2hpcHMuY2hpbGROb2Rlcy5sZW5ndGggPD0gNikge1xuICAgICAgICAgIGFkZFNoaXBzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICBhaVNpZGUuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwiY2FycmllclwiOlxuICAgICAgaWYgKHBsYXllckJvYXJkLmNoZWNoSWZTaGlwUGxhY2VtZW50SXNWYWxpZChjYXJyaWVyLmxlbmd0aCwgeCwgeSkpIHtcbiAgICAgICAgcGxheWVyQm9hcmQucGxhY2VTaGlwKGNhcnJpZXIsIHgsIHkpO1xuICAgICAgICB1cGRhdGVEaXNwbGF5KFwicGxheWVyQm9hcmRcIiwgcGxheWVyQm9hcmQpO1xuICAgICAgICBsZXQgc2hpcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2RhdGF9YCk7XG4gICAgICAgIGFkZFNoaXBzLnJlbW92ZUNoaWxkKHNoaXApO1xuICAgICAgICBpZiAoYWRkU2hpcHMuY2hpbGROb2Rlcy5sZW5ndGggPD0gNikge1xuICAgICAgICAgIGFkZFNoaXBzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICBhaVNpZGUuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwic3VibWFyaW5lXCI6XG4gICAgICBpZiAocGxheWVyQm9hcmQuY2hlY2hJZlNoaXBQbGFjZW1lbnRJc1ZhbGlkKHN1Ym1hcmluZS5sZW5ndGgsIHgsIHkpKSB7XG4gICAgICAgIHBsYXllckJvYXJkLnBsYWNlU2hpcChzdWJtYXJpbmUsIHgsIHkpO1xuICAgICAgICB1cGRhdGVEaXNwbGF5KFwicGxheWVyQm9hcmRcIiwgcGxheWVyQm9hcmQpO1xuICAgICAgICBsZXQgc2hpcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2RhdGF9YCk7XG4gICAgICAgIGFkZFNoaXBzLnJlbW92ZUNoaWxkKHNoaXApO1xuICAgICAgICBpZiAoYWRkU2hpcHMuY2hpbGROb2Rlcy5sZW5ndGggPD0gNikge1xuICAgICAgICAgIGFkZFNoaXBzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICBhaVNpZGUuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwiZGVzdHJveWVyXCI6XG4gICAgICBpZiAocGxheWVyQm9hcmQuY2hlY2hJZlNoaXBQbGFjZW1lbnRJc1ZhbGlkKGRlc3Ryb3llci5sZW5ndGgsIHgsIHkpKSB7XG4gICAgICAgIHBsYXllckJvYXJkLnBsYWNlU2hpcChkZXN0cm95ZXIsIHgsIHkpO1xuICAgICAgICB1cGRhdGVEaXNwbGF5KFwicGxheWVyQm9hcmRcIiwgcGxheWVyQm9hcmQpO1xuICAgICAgICBsZXQgc2hpcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2RhdGF9YCk7XG4gICAgICAgIGFkZFNoaXBzLnJlbW92ZUNoaWxkKHNoaXApO1xuICAgICAgICBpZiAoYWRkU2hpcHMuY2hpbGROb2Rlcy5sZW5ndGggPD0gNikge1xuICAgICAgICAgIGFkZFNoaXBzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICBhaVNpZGUuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwicGF0cm9sYm9hdFwiOlxuICAgICAgaWYgKHBsYXllckJvYXJkLmNoZWNoSWZTaGlwUGxhY2VtZW50SXNWYWxpZChwYXRyb2xib2F0Lmxlbmd0aCwgeCwgeSkpIHtcbiAgICAgICAgcGxheWVyQm9hcmQucGxhY2VTaGlwKHBhdHJvbGJvYXQsIHgsIHkpO1xuICAgICAgICB1cGRhdGVEaXNwbGF5KFwicGxheWVyQm9hcmRcIiwgcGxheWVyQm9hcmQpO1xuICAgICAgICBsZXQgc2hpcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2RhdGF9YCk7XG4gICAgICAgIGFkZFNoaXBzLnJlbW92ZUNoaWxkKHNoaXApO1xuICAgICAgICBpZiAoYWRkU2hpcHMuY2hpbGROb2Rlcy5sZW5ndGggPD0gNikge1xuICAgICAgICAgIGFkZFNoaXBzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICBhaVNpZGUuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVCb2FyZChib2FyZE5hbWUpIHtcbiAgbGV0IGJvYXJkQ2xhc3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHtib2FyZE5hbWV9YCk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgbGV0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiY2VsbFwiKTtcbiAgICAgIGNlbGwuc2V0QXR0cmlidXRlKFwiZGF0YS14XCIsIGopO1xuICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXlcIiwgaSk7XG4gICAgICBpZiAoYm9hcmROYW1lID09IFwiYWlCb2FyZFwiKSB7XG4gICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICAgICAgYXR0YWNrRXZlbnQoZS50YXJnZXQpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoYm9hcmROYW1lID09IFwicGxheWVyQm9hcmRcIikge1xuICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCAoZSkgPT4ge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgKGUpID0+IHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgZHJvcFNoaXAoZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgYm9hcmRDbGFzcy5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIGF0dGFja0V2ZW50KGVsZW1lbnQpIHtcbiAgbGV0IHggPSBlbGVtZW50LmdldEF0dHJpYnV0ZShcImRhdGEteFwiKTtcbiAgbGV0IHkgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShcImRhdGEteVwiKTtcbiAgcGxheWVyLmF0dGFjayh4LCB5LCBhaSwgYWlCb2FyZCk7XG4gIHVwZGF0ZURpc3BsYXkoXCJhaUJvYXJkXCIsIGFpQm9hcmQpO1xuICBlbGVtZW50LnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcbiAgaWYgKGFpQm9hcmQuY2hlY2tJZkFsbFNoaXBTdW5rKCkpIHtcbiAgICBlbmRHYW1lKHBsYXllci5nZXROYW1lKCkpO1xuICB9XG4gIGFpLmdlbmVyYXRlUmFuZG9tQXR0YWNrKCk7XG4gIHVwZGF0ZURpc3BsYXkoXCJwbGF5ZXJCb2FyZFwiLCBwbGF5ZXJCb2FyZCk7XG4gIGlmIChwbGF5ZXJCb2FyZC5jaGVja0lmQWxsU2hpcFN1bmsoKSkge1xuICAgIGVuZEdhbWUoXCJBSVwiKTtcbiAgfVxufVxuZnVuY3Rpb24gZW5kR2FtZSh3aW5uZXIpIHtcbiAgZW5kR2FtZU1vZGFsLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gIHdpbm5lclRleHQudGV4dENvbnRlbnQgPSBgJHt3aW5uZXJ9IGlzIHRoZSB3aW5uZXIhIWA7XG59XG4vL3JlbG9hZHMgdGhlIGdhbWVcbnBsYXlBZ2FpbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCk9PntcbiAgbG9jYXRpb24ucmVsb2FkKCk7XG59KTtcbmZ1bmN0aW9uIHVwZGF0ZURpc3BsYXkoYm9hcmROYW1lLCBib2FyZCkge1xuICBsZXQgYm9hcmRBcnJheSA9IGJvYXJkLmdldEdhbWVCb2FyZCgpO1xuICBsZXQgbWlzc2VkQXR0YWNrc0FycmF5ID0gYm9hcmQuZ2V0TWlzc2VkQXR0YWNrc0FycmF5KCk7XG5cbiAgYm9hcmRBcnJheS5mb3JFYWNoKChyb3csIHkpID0+IHtcbiAgICByb3cuZm9yRWFjaCgoY2VsbCwgeCkgPT4ge1xuICAgICAgaWYgKGNlbGwuc2hpcE5hbWUpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNlbGwuc2hpcE5hbWUuY2hlY2tIaXQoY2VsbC5zaGlwTmFtZS5nZXRTaGlwKClbY2VsbC5zaGlwSW5kZXhdKSA9PVxuICAgICAgICAgIHRydWVcbiAgICAgICAgKSB7XG4gICAgICAgICAgbGV0IHNlbGVjdGVkQ2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICBgLiR7Ym9hcmROYW1lfSBbZGF0YS14PVwiJHt4fVwiXVtkYXRhLXkgPVwiJHt5fVwiXWBcbiAgICAgICAgICApO1xuICAgICAgICAgIHNlbGVjdGVkQ2VsbC50ZXh0Q29udGVudCA9IFwiWFwiO1xuICAgICAgICAgIHNlbGVjdGVkQ2VsbC5jbGFzc0xpc3QuYWRkKFwiaGl0XCIpO1xuICAgICAgICAgIHNlbGVjdGVkQ2VsbC5jbGFzc0xpc3QucmVtb3ZlKFwib2NjdXBpZWRcIik7XG4gICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgY2VsbC5zaGlwTmFtZS5jaGVja0hpdChjZWxsLnNoaXBOYW1lLmdldFNoaXAoKVtjZWxsLnNoaXBJbmRleF0pID09XG4gICAgICAgICAgZmFsc2VcbiAgICAgICAgKSB7XG4gICAgICAgICAgaWYgKGJvYXJkTmFtZSA9PSBcInBsYXllckJvYXJkXCIpIHtcbiAgICAgICAgICAgIGxldCBzZWxlY3RlZENlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgICBgLiR7Ym9hcmROYW1lfSBbZGF0YS14PVwiJHt4fVwiXVtkYXRhLXkgPVwiJHt5fVwiXWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBzZWxlY3RlZENlbGwuY2xhc3NMaXN0LmFkZChcIm9jY3VwaWVkXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgbWlzc2VkQXR0YWNrc0FycmF5LmZvckVhY2goKGF0dGFjaykgPT4ge1xuICAgIGxldCBzZWxlY3RlZENlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYC4ke2JvYXJkTmFtZX0gW2RhdGEteD1cIiR7YXR0YWNrLnh9XCJdW2RhdGEteSA9XCIke2F0dGFjay55fVwiXWBcbiAgICApO1xuICAgIHNlbGVjdGVkQ2VsbC50ZXh0Q29udGVudCA9IFwiWFwiO1xuICAgIHNlbGVjdGVkQ2VsbC5jbGFzc0xpc3QuYWRkKFwibWlzc2VkXCIpO1xuICB9KTtcbn0iLCJpbXBvcnQge1BsYXllcn0gZnJvbSBcIi4vcGxheWVyLmpzXCI7XG5cbmV4cG9ydCBjbGFzcyBBSSBleHRlbmRzIFBsYXllcntcbiAgY29uc3RydWN0b3IobmFtZSwgZW5lbXlQbGF5ZXIsIGVuZW15Qm9hcmQpe1xuICAgIHN1cGVyKG5hbWUsZW5lbXlCb2FyZCk7XG4gICAgdGhpcy50dXJuID0gZmFsc2U7XG4gICAgdGhpcy5lbmVteVBsYXllciA9IGVuZW15UGxheWVyO1xuICAgIHRoaXMuZW5lbXlCb2FyZCA9IGVuZW15Qm9hcmQ7XG4gICAgdGhpcy5hdHRhY2tBcnJheSA9IFtdO1xuICB9XG4gIGdlbmVyYXRlUmFuZG9tQXR0YWNrKCl7XG4gICAgaWYodGhpcy5jaGVja1R1cm4oKSl7XG4gICAgICBsZXQgbnVtYmVyT2JqZWN0ID0ge3g6dW5kZWZpbmVkLCB5OiB1bmRlZmluZWR9O1xuICAgICAgd2hpbGUodHJ1ZSl7XG4gICAgICAgIGxldCBmaXJzdE51bWJlciA9IE1hdGguZmxvb3IoKE1hdGgucmFuZG9tKCkgKiAxMCkpO1xuICAgICAgICBsZXQgc2Vjb25kTnVtYmVyID0gTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSAqIDEwKSk7XG4gICAgICAgIG51bWJlck9iamVjdC54ID0gZmlyc3ROdW1iZXI7XG4gICAgICAgIG51bWJlck9iamVjdC55ID0gc2Vjb25kTnVtYmVyO1xuICAgICAgICBpZighKHRoaXMuYXR0YWNrQXJyYXkuc29tZShlID0+IGUueCA9PSBudW1iZXJPYmplY3QueCAmJiBlLnkgPT0gbnVtYmVyT2JqZWN0LnkpKSl7XG4gICAgICAgICAgdGhpcy5hdHRhY2tBcnJheS5wdXNoKG51bWJlck9iamVjdCk7XG4gICAgICAgICAgdGhpcy5hdHRhY2sobnVtYmVyT2JqZWN0LngsbnVtYmVyT2JqZWN0LnksdGhpcy5lbmVteVBsYXllciwgdGhpcy5lbmVteUJvYXJkKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBnZXRBdHRhY2tBcnJheSgpe1xuICAgIHJldHVybiB0aGlzLmF0dGFja0FycmF5O1xuICB9XG59Il0sIm5hbWVzIjpbIlNoaXAiLCJjb25zdHJ1Y3RvciIsImxlbmd0aCIsInRoaXMiLCJzaGlwIiwiQ3JlYXRlU2hpcEFycmF5Iiwic2hpcEFycmF5IiwiaSIsImhpdCIsImluZGV4IiwiZ2V0U2hpcCIsImdldFNoaXBMZW5ndGgiLCJjaGVja0hpdCIsIml0ZW0iLCJpc1N1bmsiLCJldmVyeSIsIkdhbWVCb2FyZCIsImdhbWVCb2FyZEFycmF5IiwiY3JlYXRlR2FtZUJvYXJkIiwibWlzc2VkQXR0YWNrcyIsImFycmF5IiwiYXJyYXlJdGVtIiwiaiIsInB1c2giLCJzaGlwTmFtZSIsInVuZGVmaW5lZCIsInNoaXBJbmRleCIsImdldEdhbWVCb2FyZCIsImNoZWNoSWZTaGlwUGxhY2VtZW50SXNWYWxpZCIsIngiLCJ5IiwicGxhY2VTaGlwIiwicmVjZWl2ZUF0dGFjayIsImdldE1pc3NlZEF0dGFja3NBcnJheSIsImNoZWNrSWZBbGxTaGlwU3VuayIsImtleSIsImZvckVhY2giLCJlbGVtZW50IiwiUGxheWVyIiwibmFtZSIsInR1cm4iLCJnZXROYW1lIiwic2V0TmFtZSIsImVuZFR1cm4iLCJwbGF5ZXIyIiwic3RhcnRUdXJuIiwiY2hlY2tUdXJuIiwiYXR0YWNrIiwiZW5lbXlQbGF5ZXIiLCJlbmVteUJvYXJkIiwiYmF0dGxlc2hpcEhUTUwiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjYXJyaWVySFRNTCIsInN1Ym1hcmluZUhUTUwiLCJkZXN0cm95ZXJIVE1MIiwicGF0cm9sYm9hdEhUTUwiLCJhZGRTaGlwcyIsImFpU2lkZSIsIm5hbWVNb2RhbCIsIm5hbWVJbnB1dCIsIm1vZGFsRm9ybSIsInBsYXllck5hbWUiLCJlbmRHYW1lTW9kYWwiLCJwbGF5QWdhaW5CdXR0b24iLCJ3aW5uZXJUZXh0IiwiY2FycmllciIsImJhdHRsZXNoaXAiLCJkZXN0cm95ZXIiLCJzdWJtYXJpbmUiLCJwYXRyb2xib2F0IiwiY2FycmllckFJIiwiYmF0dGxlc2hpcEFJIiwiZGVzdHJveWVyQUkiLCJzdWJtYXJpbmVBSSIsInBhdHJvbGJvYXRBSSIsInBsYXllckJvYXJkIiwiYWlCb2FyZCIsInBsYXllciIsImFpIiwic3VwZXIiLCJhdHRhY2tBcnJheSIsImdlbmVyYXRlUmFuZG9tQXR0YWNrIiwibnVtYmVyT2JqZWN0IiwiZmlyc3ROdW1iZXIiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJzZWNvbmROdW1iZXIiLCJzb21lIiwiZSIsImdldEF0dGFja0FycmF5IiwicGxhY2VBSVNoaXAiLCJudW1iZXJBcnJheSIsImRyYWdTdGFydGVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImRhdGFUcmFuc2ZlciIsInNldERhdGEiLCJ0YXJnZXQiLCJpZCIsImRyb3BTaGlwIiwiZGF0YSIsImdldERhdGEiLCJwYXJzZUludCIsImdldEF0dHJpYnV0ZSIsInVwZGF0ZURpc3BsYXkiLCJyZW1vdmVDaGlsZCIsImNoaWxkTm9kZXMiLCJzdHlsZSIsImRpc3BsYXkiLCJjcmVhdGVCb2FyZCIsImJvYXJkTmFtZSIsImJvYXJkQ2xhc3MiLCJjZWxsIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInNldEF0dHJpYnV0ZSIsImF0dGFja0V2ZW50IiwicHJldmVudERlZmF1bHQiLCJhcHBlbmRDaGlsZCIsInBvaW50ZXJFdmVudHMiLCJlbmRHYW1lIiwid2lubmVyIiwidGV4dENvbnRlbnQiLCJib2FyZCIsImJvYXJkQXJyYXkiLCJtaXNzZWRBdHRhY2tzQXJyYXkiLCJyb3ciLCJzZWxlY3RlZENlbGwiLCJyZW1vdmUiLCJ2YWx1ZSIsImxvY2F0aW9uIiwicmVsb2FkIl0sInNvdXJjZVJvb3QiOiIifQ==